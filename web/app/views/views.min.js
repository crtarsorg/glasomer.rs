function calculateMatchingResult(a,b){var c={"Serbian Progressive Party":0,"Socialist party of Serbia":0,"Democratic Party":0,"New Democratic Party":0};return $.each(a,function(a,d){"Budžetski prioriti"!=d.question&&"Budžetski prioriti"!=b.question?$.each(d,function(a,d){if(d.question==b.question){if(b.answer==d.politiciansAnswers["Serbian Progressive Party"].answer){var e=.943395;b.importance_level==d.politiciansAnswers["Serbian Progressive Party"].importance&&(e+=.943395),c["Serbian Progressive Party"]=e}if(b.answer==d.politiciansAnswers["Socialist party of Serbia"].answer){var e=.943395;b.importance_level==d.politiciansAnswers["Socialist party of Serbia"].importance&&(e+=.943395),c["Socialist party of Serbia"]=e}if(b.answer==d.politiciansAnswers["Democratic Party"].answer){var e=.943395;b.importance_level==d.politiciansAnswers["Democratic Party"].importance&&(e+=.943395),c["Democratic Party"]=e}if(b.answer==d.politiciansAnswers["New Democratic Party"].answer){var e=.943395;b.importance_level==d.politiciansAnswers["New Democratic Party"].importance&&(e+=.943395),c["New Democratic Party"]=e}}}):"Budžetski prioriti"==d.question&&"Budžetski prioriti"==b.question&&$.each(d.politiciansAnswers,function(a,d){$.each(d.increase,function(d,e){isInArray(e,b.answer)&&(c[a]=c[a]+1.88679)})})}),c}function isInArray(a,b){return b.indexOf(a)>-1}function initCategoriesWithQuestions(a,b){readTextFile("app/static/questions.json",function(c){var d=JSON.parse(c),e=new Categories([]);for(var f in d){var g=[];for(var h in d[f]){var i=d[f][h].question,h=getQuestion(i,["Slažem se","Ne slažem se","Nemam stav"]);g.push(h)}var j=new Category({name:f,questions:g});e.push(j)}var k=JSON.stringify(e.toJSON());a.html(b({categories:JSON.parse(k)}))})}function readTextFile(a,b){var c=new XMLHttpRequest;c.overrideMimeType("application/json"),c.open("GET",a,!0),c.onreadystatechange=function(){4===c.readyState&&"200"==c.status&&b(c.responseText)},c.send(null)}function getQuestion(a,b){var c=getAnswers(b);return new Question({text:a,possibleAnswers:c})}function getAnswers(a){for(var b=new Answers([]),c=0;c<a.length;c++){var d=new Answer({text:a[c],value:a[c]});b.push(d)}return b}window.QuestionnaireView=Backbone.View.extend({template:JST["app/templates/questionnaire.hbs"],initialize:function(){this.render()},render:function(){return initCategoriesWithQuestions($(this.el),this.template),Handlebars.registerHelper("setIndex",function(a){this.name=a}),Handlebars.registerHelper("if_eq",function(a,b,c){return a==b?c.fn(this):c.inverse(this)}),this},events:{"click #btn_save":"dataHandler","change #category":"categorySwitch"},dataHandler:function(){var a=($("#category").val(),[]);$(".question").each(function(){var b={},c=$(this).find("div").find("h2").text().trim(),d=$("input[name='"+c+"']:checked").val();b={question:c,answer:d},$(":radio:checked",".question-fieldset").map(function(){var a;a=void 0!=b.answer?this.value:void 0,b.importance_level=a}).get(),a.push(b)});var b=[];$("input:checkbox.css-checkbox",".increase_budget_chb").each(function(){var a=this.checked?$(this).val():"";""!=a&&b.push(a)});var c={question:"Budžetski prioriti",answer:b};if(a.push(c),0==a.length)alert("You must fill all of the fields to continue.!");else{new ResultView({element:"#container",data:a})}},categorySwitch:function(){var a=$("#category").val();$(".categories").each(function(){$(this).attr("id")==a?$(this).css("display","block"):$(this).css("display","none")})}}),window.ResultView=Backbone.View.extend({template:JST["app/templates/results.hbs"],initialize:function(a){this.render(a)},render:function(a){var b,c=this.template;readTextFile("app/static/questions.json",function(d){var e=JSON.parse(d),f={"Serbian Progressive Party":0,"Socialist party of Serbia":0,"Democratic Party":0,"New Democratic Party":0};for(var g in a.data)""!=a.data[g].question&&void 0!=a.data[g].answer&&(b=calculateMatchingResult(e,a.data[g]),f={"Serbian Progressive Party":f["Serbian Progressive Party"]+b["Serbian Progressive Party"],"Socialist party of Serbia":f["Socialist party of Serbia"]+b["Socialist party of Serbia"],"Democratic Party":f["Democratic Party"]+b["Democratic Party"],"New Democratic Party":f["New Democratic Party"]+b["New Democratic Party"]});var h=[];$.each(f,function(a,b){var c=Math.round(b),d={partyName:a,matchingResult:c.toString()+"%"};h.push(d)}),h=h.sort(function(a,b){return a.matchingResult<b.matchingResult?1:-1}).slice(0,3),$(a.element).html(c({results:h}))})}});